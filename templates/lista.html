{% extends "template.html" %}
{% block conteudo %}

<div class="modal fade" id="FiltroCidadeModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <form class="row g-3" action="/filtro" method="post">
    <input type="hidden" name="filtro" value="filtra_cidade">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="FiltroCidadeModalLabel">Filtrar cidade</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="filtra_cidade">Cidade</label>
          <select class="form-select" id="filtra_cidade" name="filtra_cidade">
            <option value="0" selected>Selecione a cidade</option>
            {% for cidade in cidades %}
            <option value="{{ cidade._id_cidade }}">{{ cidade._cidade_nome}}</option>
            {% endfor %}
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
        <button type="submit" class="btn btn-dark">Filtrar</button>
      </div>
    </div>
  </div>
  </form>
</div>

<div class="modal fade" id="FiltroPropModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <form class="row g-3" action="/filtro" method="post">
    <input type="hidden" name="filtro" value="filtra_prop">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="FiltroPropModalLabel">Filtrar proprietarios</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="filtra_prop">Proprietarios</label>
          <select class="form-select" id="filtra_prop" name="filtra_prop">
            <option value="0" selected>Selecione o proprietario</option>
          {% for proprietario in proprietarios %}
            <option value="{{ proprietario._id }}">{{ proprietario._nome}}</option>
            {% endfor %}
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
        <button type="submit" class="btn btn-dark">Filtrar</button>
      </div>
    </div>
  </div>
  </form>
</div>

<div class="modal fade" id="FiltroStatusModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <form class="row g-3" action="/filtro" method="post">
    <input type="hidden" name="filtro" value="filtra_status">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="FiltroStatusModalLabel">Filtrar Status</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="filtra_status">Status</label>
          <select class="form-select" id="filtra_status" name="filtra_status">
            <option value="0" selected>Selecione o status</option>
                    <option value="Livre">Livre</option>
                    <option value="Ocupado">Ocupado</option>
                    <option value="Vendido">Vendido</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
        <button type="submit" class="btn btn-dark">Filtrar</button>
      </div>
    </div>
  </div>
  </form>
</div>



<div class="content-list">
  <nav>
    <div class="nav nav-tabs" id="nav-tab" role="tablist">
      <a class="nav-link active" id="nav-corretor-tab" data-bs-toggle="tab" href="#nav-corretor" role="tab"
        aria-controls="nav-corretor" aria-selected="true">Lista de Corretor</a>
      <a class="nav-link" id="nav-imovel-tab" data-bs-toggle="tab" href="#nav-imovel" role="tab"
        aria-controls="nav-imovel" aria-selected="false">Lista de Imovel</a>
      <a class="nav-link" id="nav-prop-tab" data-bs-toggle="tab" href="#nav-prop" role="tab" aria-controls="nav-prop"
        aria-selected="false">Lista de proprietario</a>
    </div>
  </nav>
  <div class="tab-content" id="nav-tabContent">
    <div class="tab-pane fade show active" id="nav-corretor" role="tabpanel" aria-labelledby="nav-corretor-tab">
      <table class="table table-striped table-responsive table-bordered">
        <thead class="thead-default">
          <tr>
            <th>ID</th>
            <th>Nome</th>
            <th>Imobiliária</th>
            <th>CRECI</th>
            <th>CPF</th>
            <th>Celular</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          {% for corretor in corretores %}
          <tr>
            <td>{{ corretor._id_corr }}</td>
            <td>{{ corretor._nome }}</td>
            <td>{{ corretor._imobil }}</td>
            <td>{{ corretor._creci }}</td>
            <td>{{ corretor._cpf }}</td>
            <td>{{ corretor._celular }}</td>
            <td><a href="{{url_for('editar_corretor', id=corretor._id_corr)}}"><button type="button" class="btn"><i>
            <img src="../static/img/icon/pen.svg"></i></button></a>
              <button type="button" class="btn" data-bs-toggle="modal" data-bs-target="#modal_corr{{ corretor._id_corr}}"><i>
                    <img src="../static/img/icon/trash.svg"></i></button>

                <div class="modal fade" id="modal_corr{{ corretor._id_corr}}" tabindex="-1" aria-labelledby="exampleModalLabel"
                  aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel1">Deseja excluir o registro {{ corretor._id_corr }} </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                        Você tem certeza que deseja excluir o corretor: {{ corretor._nome }},
                        CPF: {{ corretor._cpf }}
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                        <a href="{{url_for('deletar_corr', id=corretor._id_corr)}}"><button type="button"
                            class="btn btn-danger">Deletar corretor</button></a>
                      </div>
                    </div>
                  </div>
                </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div class="tab-pane fade" id="nav-imovel" role="tabpanel" aria-labelledby="nav-imovel-tab">
      <br>

      <nav class="navbar navbar-light bg-light">
        <div class="container-fluid">
          <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenu2" data-bs-toggle="dropdown" aria-expanded="false">
              filtros
            </button>
          <ul class="dropdown-menu" aria-labelledby="dropdownMenu2">
              <li> <button type="button" class="dropdown-item" data-bs-toggle="modal" data-bs-target="#FiltroCidadeModal">Filtrar por cidade</button></li>
                 <li> <button type="button" class="dropdown-item" data-bs-toggle="modal" data-bs-target="#FiltroPropModal">Filtrar por proprietarios</button></li>
                   <li> <button type="button" class="dropdown-item" data-bs-toggle="modal" data-bs-target="#FiltroStatusModal">Filtrar por status</button></li>
            </ul>
          </div>
          <form class="d-flex">
            <input class="form-control me-2" type="text"  id="search_field_input" placeholder="Search" aria-label="Search" onkeyup='search_table()'>
          </form>
        </div>
      </nav>
      <div>
        <table class="table table-striped table-responsive table-bordered" id="myTable">

          <thead class="thead-default">
            <tr>
              <th>ID</th>
              <th>Tipo</th>
              <th>Cidade</th>
              <th>Bairro</th>
              <th>Endereço</th>
              <th>Proprietario</th>
              <th>Telefone</th>
              <th>Status</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
            {% for l in lista %}
            <tr>
              <td>{{ l._imob_id}}</td>
              <td>{{ l._tipo._tipo_nome}}</td>
              <td>{{ l._cidade._cidade_nome}}</td>
              <td>{{ l._bairro._bairro_nome}}</td>
              <td>{{ l._endereco}}</td>
              <td>{{ l._proprietario._nome}}</td>
              <td>{{ l._proprietario._telefone}}</td>
              <td>{{ l._status }}</td>
              <td><a href="{{url_for('view_imovel', id=l._imob_id)}}"><button type="button" class="btn"><i>
                      <img src="../static/img/icon/eye.svg"></i></button></a>
                <a href="{{url_for('editar_imovel', id=l._imob_id)}}"><button type="button" class="btn"><i>
                      <img src="../static/img/icon/pen.svg"></i></button></a>


                <button type="button" class="btn" data-bs-toggle="modal" data-bs-target="#modal_imob{{ l._imob_id}}"><i>
                    <img src="../static/img/icon/trash.svg"></i></button>

                <div class="modal fade" id="modal_imob{{ l._imob_id}}" tabindex="-1" aria-labelledby="exampleModalLabel"
                  aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Deseja excluir o registro {{ l._imob_id }} </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                        Você tem certeza que deseja excluir o imovel: {{ l._endereco }}
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                        <a href="{{url_for('deleta_imovel', id=l._imob_id)}}"><button type="button"
                            class="btn btn-danger">Deletar imovel</button></a>
                      </div>
                    </div>
                  </div>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    <div class="tab-pane fade" id="nav-prop" role="tabpanel" aria-labelledby="nav-prop-tab">
      <table class="table table-striped table-responsive table-bordered">
        <thead class="thead-default">
          <tr>
            <th>ID</th>
            <th>Nome</th>
            <th>CPF</th>
            <th>Telefone</th>
            <th>E-mail</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          {% for proprietario in proprietarios %}
          <tr>
            <td>{{ proprietario._id }}</td>
            <td>{{ proprietario._nome }}</td>
            <td>{{ proprietario._cpf }}</td>
            <td>{{ proprietario._telefone }}</td>
            <td>{{ proprietario._email }}</td>
            <td><a href="{{url_for('editar_proprietario', id=proprietario._id)}}"><button type="button" class="btn"><i>
              <img src="../static/img/icon/pen.svg"></i></button></a>
              <button type="button" class="btn" data-bs-toggle="modal" data-bs-target="#modal_prop{{ proprietario._id}}"><i>
                    <img src="../static/img/icon/trash.svg"></i></button>

                <div class="modal fade" id="modal_prop{{ proprietario._id}}" tabindex="-1" aria-labelledby="exampleModalLabel"
                  aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel2">Deseja excluir o registro {{ proprietario._id }} </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                        Você tem certeza que deseja excluir o proprietário: {{ proprietario._nome }},
                        CPF: {{ proprietario._cpf }}
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                        <a href="{{url_for('deletar_prop', id=proprietario._id)}}"><button type="button"
                            class="btn btn-danger">Deletar proprietário</button></a>
                      </div>
                    </div>
                  </div>
                </div>

            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
<script>
function search_table(){
<<<<<<< HEAD
  // Declare variables
=======
  // Declare variables 
>>>>>>> main
  var input, filter, table, tr, td, i;
  input = document.getElementById("search_field_input");
  filter = input.value.toUpperCase();
  table = document.getElementById("myTable");
  tr = table.getElementsByTagName("tr");

  // Loop through all table rows, and hide those who don't match the search query
  for (i = 0; i < tr.length; i++) {
<<<<<<< HEAD
    td = tr[i].getElementsByTagName("td") ;
=======
    td = tr[i].getElementsByTagName("td") ; 
>>>>>>> main
    for(j=0 ; j<td.length ; j++)
    {
      let tdata = td[j] ;
      if (tdata) {
        if (tdata.innerHTML.toUpperCase().indexOf(filter) > -1) {
          tr[i].style.display = "";
<<<<<<< HEAD
          break ;
        } else {
          tr[i].style.display = "none";
        }
      }
=======
          break ; 
        } else {
          tr[i].style.display = "none";
        }
      } 
>>>>>>> main
    }
  }
}
</script>
{% endblock %}